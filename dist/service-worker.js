const CACHE_NAME="story-app-v1",ASSETS_TO_CACHE=["/","/index.html","/manifest.json","/styles/styles.css"];self.addEventListener("install",(e=>{console.log("Service Worker installing..."),e.waitUntil(caches.open(CACHE_NAME).then((e=>(console.log("Caching app shell"),e.addAll(ASSETS_TO_CACHE)))).catch((e=>{console.warn("Cache addAll error:",e)}))),self.skipWaiting()})),self.addEventListener("activate",(e=>{console.log("Service Worker activating..."),e.waitUntil(caches.keys().then((e=>Promise.all(e.map((e=>{if(e!==CACHE_NAME)return console.log("Deleting old cache:",e),caches.delete(e)})))))),self.clients.claim()})),self.addEventListener("fetch",(e=>{const{request:t}=e;"GET"===t.method&&(t.url.startsWith("chrome-extension://")||(t.url.includes("/v1/")?e.respondWith(fetch(t).then((e=>{if(e.ok){const n=e.clone();caches.open(CACHE_NAME).then((e=>{e.put(t,n)}))}return e})).catch((()=>caches.match(t).then((e=>e||caches.match("/index.html")))))):e.respondWith(caches.match(t).then((e=>e||fetch(t).then((e=>{if(e&&200===e.status){const n=e.clone();caches.open(CACHE_NAME).then((e=>{e.put(t,n)}))}return e})))).catch((()=>"image"===t.destination?new Response('<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100"><text x="50" y="50" text-anchor="middle" dy=".3em" fill="#999">Offline</text></svg>',{headers:{"Content-Type":"image/svg+xml"}}):new Response("Offline - Resource not available",{status:503,statusText:"Service Unavailable",headers:new Headers({"Content-Type":"text/plain"})}))))))})),self.addEventListener("push",(e=>{console.log("Push notification diterima:",e);let t={title:"Story App Notification",options:{body:"Anda menerima notifikasi baru",icon:"/images/icon-192x192.png",badge:"/images/badge-72x72.png"}};if(e.data)try{const n=e.data.json();t={title:n.title||"Story App Notification",options:{body:n.options?.body||"Anda menerima notifikasi baru",icon:"/images/icon-192x192.png",badge:"/images/badge-72x72.png",data:n.options?.data||{}}}}catch(n){t.options.body=e.data.text()}e.waitUntil(self.registration.showNotification(t.title,t.options))})),self.addEventListener("notificationclick",(e=>{console.log("Notification clicked:",e),e.notification.close(),e.waitUntil(clients.matchAll({type:"window"}).then((e=>{for(let t=0;t<e.length;t++){const n=e[t];if("/"===n.url&&"focus"in n)return n.focus()}if(clients.openWindow)return clients.openWindow("/")})))})),self.addEventListener("notificationclose",(e=>{console.log("Notification closed:",e)}));